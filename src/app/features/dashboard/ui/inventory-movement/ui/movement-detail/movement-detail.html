<main class="container-layout flex flex-col min-h-full">
  @if (isLoading()) {
    <section hlmCard class="card-elevated">
      <header hlmCardHeader>
        <div class="flex items-center gap-4">
          <hlm-skeleton class="h-10 w-10 rounded-full"/>
          <div class="flex-1 space-y-2">
            <hlm-skeleton class="h-6 w-64"/>
            <hlm-skeleton class="h-4 w-96"/>
          </div>
        </div>
      </header>
      <div hlmCardContent class="space-y-6">
        <hlm-skeleton class="h-32 w-full"/>
        <hlm-skeleton class="h-32 w-full"/>
        <hlm-skeleton class="h-32 w-full"/>
      </div>
    </section>
  } @else if (notFound()) {
    <section hlmCard class="card-elevated">
      <div hlmCardContent class="py-12 text-center">
        <ng-icon hlm size="xl" name="lucideBox" class="mx-auto mb-4 text-muted-foreground"/>
        <h2 class="text-2xl font-semibold mb-2">Movimiento No Encontrado</h2>
        <p class="text-muted-foreground mb-6">
          El movimiento de inventario que buscas no existe o fue eliminado.
        </p>
        <button hlmBtn variant="default" (click)="goBack()" class="cursor-pointer">
          <ng-icon hlm size="sm" name="lucideArrowLeft" class="mr-2"/>
          Volver al Historial
        </button>
      </div>
    </section>
  } @else if (movement(); as mov) {
    <section hlmCard class="card-elevated">
      <header hlmCardHeader>
        <div class="flex items-start justify-between gap-4 flex-col sm:flex-row">
          <div class="flex-1">
            <div class="flex items-center gap-3 mb-2">
              <button
                hlmBtn
                variant="ghost"
                size="sm"
                (click)="goBack()"
                class="flex items-center gap-2 cursor-pointer"
              >
                <ng-icon hlm size="sm" name="lucideArrowLeft"/>
                Volver
              </button>
              <hlm-separator orientation="vertical" class="h-6"/>
              <span class="text-sm text-muted-foreground">Movimiento #{{ mov.movementId }}</span>
            </div>
            <h1 hlmCardTitle class="text-2xl font-bold">Detalle del Movimiento</h1>
            <p hlmCardDescription class="text-sm text-muted-foreground mt-1">
              Información completa sobre el movimiento de inventario
            </p>
          </div>
          <div>
          <span
            hlmBadge
            [variant]="getMovementTypeBadgeVariant(mov.movementType)"
            class="text-sm px-3 py-1"
          >
            {{ getMovementTypeLabel(mov.movementType) }}
          </span>
          </div>
        </div>
      </header>

      <hlm-separator class="my-4"/>

      <div hlmCardContent class="space-y-6">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <section hlmCard class="!bg-muted/30 border-border">
            <header hlmCardHeader>
              <div class="flex items-center gap-2">
                <ng-icon hlm size="sm" name="lucidePackage" class="text-primary"/>
                <h3 hlmCardTitle class="text-lg">Información del Producto</h3>
              </div>
            </header>
            <div hlmCardContent class="space-y-3">
              <div>
                <span class="text-sm text-muted-foreground">Producto</span>
                <p class="font-medium">{{ mov.product.name }}</p>
              </div>
              <div>
                <span class="text-sm text-muted-foreground">ID del Producto</span>
                <p class="font-medium">#{{ mov.product.productId }}</p>
              </div>
            </div>
          </section>

          <section hlmCard class="!bg-muted/30 border-border">
            <header hlmCardHeader>
              <div class="flex items-center gap-2">
                <ng-icon hlm size="sm" name="lucideBox" class="text-primary"/>
                <h3 hlmCardTitle class="text-lg">Cambio de Inventario</h3>
              </div>
            </header>
            <div hlmCardContent class="space-y-3">
              <div>
                <span class="text-sm text-muted-foreground">Cantidad del Movimiento</span>
                <p class="text-3xl" [class]="getQuantityClass(mov.quantityChange)">
                  {{ formatQuantity(mov.quantityChange) }} unidades
                </p>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <span class="text-sm text-muted-foreground">Stock Anterior</span>
                  <p class="font-medium">{{ mov.previousStock }} unidades</p>
                </div>
                <div>
                  <span class="text-sm text-muted-foreground">Stock Nuevo</span>
                  <p class="font-medium">{{ mov.newStock }} unidades</p>
                </div>
              </div>
            </div>
          </section>
        </div>

        @if (hasUser()) {
          <section hlmCard class="!bg-muted/30 border-border">
            <header hlmCardHeader>
              <div class="flex items-center gap-2">
                <ng-icon hlm size="sm" name="lucideUser" class="text-primary"/>
                <h3 hlmCardTitle class="text-lg">Usuario Responsable</h3>
              </div>
            </header>
            <div hlmCardContent class="space-y-3">
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                  <span class="text-sm text-muted-foreground">Nombre Completo</span>
                  <p class="font-medium">{{ mov.user!.fullName }}</p>
                </div>
                <div>
                  <span class="text-sm text-muted-foreground">Usuario</span>
                  <p class="font-medium">{{ mov.user!.username }}</p>
                </div>
              </div>
              <div>
                <span class="text-sm text-muted-foreground">ID del Usuario</span>
                <p class="font-medium">#{{ mov.user!.userId }}</p>
              </div>
            </div>
          </section>
        } @else {
          <section hlmCard class="!bg-muted/30 border-border">
            <header hlmCardHeader>
              <div class="flex items-center gap-2">
                <ng-icon hlm size="sm" name="lucideUser" class="text-muted-foreground"/>
                <h3 hlmCardTitle class="text-lg">Usuario Responsable</h3>
              </div>
            </header>
            <div hlmCardContent>
              <p class="text-muted-foreground italic">Usuario no disponible</p>
            </div>
          </section>
        }
        @if (hasSupplier()) {
          <section hlmCard class="!bg-muted/30 border-border">
            <header hlmCardHeader>
              <div class="flex items-center gap-2">
                <ng-icon hlm size="sm" name="lucideTruck" class="text-primary"/>
                <h3 hlmCardTitle class="text-lg">Información del Proveedor</h3>
              </div>
            </header>
            <div hlmCardContent class="space-y-3">
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                  <span class="text-sm text-muted-foreground">Nombre del Proveedor</span>
                  <p class="font-medium">{{ mov.supplier!.name }}</p>
                </div>
                @if (mov.supplier!.taxId) {
                  <div>
                    <span class="text-sm text-muted-foreground">RUC</span>
                    <p class="font-medium">{{ mov.supplier!.taxId }}</p>
                  </div>
                }
              </div>
              <div>
                <span class="text-sm text-muted-foreground">ID del Proveedor</span>
                <p class="font-medium">#{{ mov.supplier!.supplierId }}</p>
              </div>
            </div>
          </section>
        }
        @if (hasReservation()) {
          <section hlmCard class="!bg-muted/30 border-border">
            <header hlmCardHeader>
              <div class="flex items-center gap-2">
                <ng-icon hlm size="sm" name="lucideShoppingCart" class="text-primary"/>
                <h3 hlmCardTitle class="text-lg">Reserva Asociada</h3>
              </div>
            </header>
            <div hlmCardContent>
              <div>
                <span class="text-sm text-muted-foreground">ID de Reserva</span>
                <p class="font-medium">#{{ mov.reservationId }}</p>
              </div>
            </div>
          </section>
        }
        @if (hasNotes()) {
          <section hlmCard class="!bg-muted/30 border-border">
            <header hlmCardHeader>
              <div class="flex items-center gap-2">
                <ng-icon hlm size="sm" name="lucideFileText" class="text-primary"/>
                <h3 hlmCardTitle class="text-lg">Notas</h3>
              </div>
            </header>
            <div hlmCardContent>
              <p class="whitespace-pre-wrap">{{ mov.notes }}</p>
            </div>
          </section>
        }

        <section hlmCard class="!bg-muted/30 border-border">
          <header hlmCardHeader>
            <div class="flex items-center gap-2">
              <ng-icon hlm size="sm" name="lucideCalendar" class="text-primary"/>
              <h3 hlmCardTitle class="text-lg">Información Adicional</h3>
            </div>
          </header>
          <div hlmCardContent>
            <div>
              <span class="text-sm text-muted-foreground">Fecha y Hora de Creación</span>
              <p class="font-medium">{{ mov.createdAt | date : 'dd/MM/yyyy HH:mm:ss' }}</p>
            </div>
          </div>
        </section>
      </div>
    </section>
  }
</main>
