<main class="w-full min-h-screen flex items-center justify-center p-8 lg:p-12">
  <section hlmCard class="w-full max-w-md">
    <header hlmCardHeader class="space-y-1">
      <h3 hlmCardTitle class="text-2xl">Restablecer contraseña</h3>
      <p hlmCardDescription>
        @if (!tokenError()) {
          Ingresa tu nueva contraseña que cumpla con los requisitos de seguridad
        } @else {
          Hubo un problema con el enlace de restablecimiento
        }
      </p>
    </header>

    <div hlmCardContent>
      @if (tokenError()) {
        <div class="space-y-4">
          <div class="rounded-lg bg-destructive/10 p-4 space-y-2">
            <p class="text-sm text-destructive font-medium">{{ tokenError() }}</p>
            <p class="text-xs text-muted-foreground">
              Por seguridad, los enlaces son válidos solo por 15 minutos.
            </p>
          </div>

          <button hlmBtn variant="outline" class="w-full" routerLink="/auth/forgot-password">
            Solicitar nuevo enlace
          </button>
        </div>
      } @else {
        <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" class="space-y-4">
          <div class="space-y-2">
            <label hlmLabel for="new-password">Nueva contraseña</label>
            <div class="relative">
              <input
                [type]="showPassword() ? 'text' : 'password'"
                id="new-password"
                placeholder="••••••••"
                formControlName="newPassword"
                hlmInput
                [class.border-destructive]="getFieldError('newPassword')"
                class="pr-10"
              />
              <button
                type="button"
                (click)="togglePasswordVisibility()"
                class="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground"
              >
                <ng-icon [name]="showPassword() ? 'lucideEyeOff' : 'lucideEye'" size="18"/>
              </button>
            </div>
            @if (getFieldError('newPassword')) {
              <p class="text-xs text-destructive">{{ getFieldError('newPassword') }}</p>
            }
          </div>

          <app-password-strength-indicator [password]="passwordValue() || ''"/>

          <div class="space-y-2">
            <label hlmLabel for="confirm-password">Confirmar contraseña</label>
            <div class="relative">
              <input
                [type]="showConfirmPassword() ? 'text' : 'password'"
                id="confirm-password"
                placeholder="••••••••"
                formControlName="confirmPassword"
                hlmInput
                [class.border-destructive]="getFieldError('confirmPassword')"
                class="pr-10"
              />
              <button
                type="button"
                (click)="toggleConfirmPasswordVisibility()"
                class="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground"
              >
                <ng-icon [name]="showConfirmPassword() ? 'lucideEyeOff' : 'lucideEye'" size="18"/>
              </button>
            </div>
            @if (getFieldError('confirmPassword')) {
              <p class="text-xs text-destructive">{{ getFieldError('confirmPassword') }}</p>
            }
          </div>

          <button
            hlmBtn
            type="submit"
            class="w-full cursor-pointer"
            [disabled]="resetPasswordForm.invalid || isLoading()"
          >
            @if (isLoading()) {
              <hlm-spinner size="sm" class="mr-2"/>
              <span>Restableciendo...</span>
            } @else {
              <span>Restablecer contraseña</span>
            }
          </button>
        </form>
      }
    </div>

    <footer hlmCardFooter class="flex justify-center">
      <a
        routerLink="/auth/account/login"
        class="text-sm text-muted-foreground hover:text-foreground underline underline-offset-4"
      >
        Volver al inicio de sesión
      </a>
    </footer>
  </section>
</main>
